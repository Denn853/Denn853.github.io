<!DOCTYPE html>

<html>
	<head>
		<title>Dennys ENTI(M04UF1) - Juego</title>
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">	
		
		<link rel="stylesheet" href="base.css" />
		<link rel="stylesheet" href="game.css" />
		
		<script>
			let game_data;
		
			let current_room = 0;
			let items_picked = [];
			
			function game (data) {
				game_data = data;
				
				document.getElementById("terminal").innerHTML = "<p><strong>¡Bienvenidos a ENTIerrame!</strong> El juego de terror definitivo.</p>";
				
				document.getElementById("terminal").innerHTML += "<p>Te encuentras en "+game_data.rooms[current_room].name+". ¿Qué quieres hacer?</p>";
			}
			
			function terminal_out (info) {
				
				let terminal = document.getElementById("terminal");

				terminal.innerHTML += info;

				terminal.scrollTop = terminal.scrollHeight;
			}
			
			function parseCommand (command) {
				console.log("El comando ", command);
			
				switch (command){
					case "ver":
						terminal_out("<p>"+game_data.rooms[current_room].description+"</p>");
						break;

					case "ir":
						let doors = "";
						let doors_num = game_data.rooms[current_room].doors.length;
						
						for (let i = 0; i < doors_num; i++) {
							doors += game_data.rooms[current_room].doors[i]+", ";
						}
						terminal_out("<p>Puedes ir a: "+doors+"</p>");
						break;

					default:
						terminal_out("<p><strong>Error</strong>: "+command+" commando no encontrado</p>");
				}
			}	
			
			function getRoomNumber (room) {
				for (let i = 0; i < game_data.rooms.length; i++) {
					if (game_data.rooms[i].id == room) {
						return i;
					}
				}
				return -1;
			}
			
			function getDoorNumber (door) {
				for (let i = 0; i < game_data.rooms.length; i++) {
					if (game_data.rooms[i].id == room) {
						return i;
					}
				}
				return -1;
			}
			
			function parseInstruction (instruction) {
				console.log("La instrucción ", instruction);
				
				switch (instruction[0]) {
					case "ver":
						break;
					
					case "ir":
						let door_num = getDoorNumber(instruction[1]);
						if (door_num < 0){
							console.log("Puerta errónea");
							return;
						}

						console.log("Door Num: ",door_num);

						let room_num = findRoomNumber(game_data.doors[door_number].rooms[0]);
						/*let next_room_name = "";
						
						if (room1_id == current_room) {
							current_room = findRoomNumber(game_data.doors[door_num].rooms[1]);
						}*/
						
						
						if (room_num < 0){
							console.log("Habitación errónea");
							return;
						} 

						console.log("Room Num: ", room_num); 

						if (room_num == current_room){
							current_room = getRoomNumber(game_data.doors[door_num].rooms[1]);
						}
						else{
							current_room = room_num;
						}
						
						/* next_room_name = game_data.rooms[current_room].name
						
						terminalOut("<p>Cambiando de habitación a " + next_room_name + "</p>");
						*/
						
						//terminal_out("<p>Cambiando de habitación a " + next_room_name + "</p>");
						break;
					
					case "agarrar":
					
						break;
					
					default:
						terminal_out("<p><strong>Error</strong>: "+instruction[0]+" commando no encontrado</p>");
				}
			}
			
			function readAction() {
				let instruction = document.getElementById("commands").value;
				let instruction_trim = instruction.trim();

				let data = instruction_trim.split(" ");
				//instruction = "";

				if (data.length == 0 || instruction_trim == ""){
					terminal_out("<p><strong>Error</strong>: escribe una instrucción</p>");
					return;
				}
				if (data.length == 1){
					parseCommand(data[0]);
				}
				else {
					console.log("parseInstruction"); 
					parseInstruction(data);
				}
			}
			
			fetch("https://denn853.github.io/game.json")
					.then(response => response.json())
					.then(data => game(data));
					
		</script>
	</head>
	
	<body>
		<header>
			<h1>Dennys HeMu, página de ENTI (M04UF1)</h1>
			
			<nav>
				<ul id="main-menu">
					<li id="menu-presentation"><a href="index.html">Presentación</a></li>
					<li id="menu-hobbies"><a href="hobbies.html">Hobbies</a></li>
					<li id="menu-contact"><a href="contact.html">Contacto</a></li>
					<li id="menu-cv"><a href="cv.html">Currículum</a></li>
					<li id="menu-game"><a href="game.html">Juego</a></li>
				</ul>
			</nav>
		</header>
		
		<main>
			<article>
				<h2>Juegaco</h2>
			
				<form>
					<div id="terminal"></div>
					<input type="text" id="commands" />
					<input type="submit" value="Acción" onclick="readAction(); return false;"/>
				</form>
			</article>
			
			<aside>
				<h2>Lateral</h2>
				<p>Ejemplo de menú lateral</p>
			</aside>
		</main>
		
		<footer>
			<p>Dennys Hernández Muñiz © <span id="footer-year">2022</span> </p>
			
			<script>
				document.getElementById("footer-year").innerHTML = new Date().getFullYear();
			</script>
			
		</footer>
	</body>
</html>